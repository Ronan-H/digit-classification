<!DOCTYPE html>

<html>
    <head>
            <meta charset="utf-8"/>
            <link rel="stylesheet" href="static/style.css">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>

    <body onload="init()">
        <h2>Digit classifier</h2>
        <h4>Draw a digit below to see how the neural network classifies it</h4>

        <canvas id="digit-canvas" width="150" height="150"></canvas>
        <br />
        <input id="clear-button" type="button" value="Clear" onclick="clearCanvas()" />
        <input id="classify-button" type="button" value="Classify" />

        <script>
            // adapted from https://stackoverflow.com/a/8398189
            var canvas, ctx;
            var drawing = false;
            var prevX = 0,
                currX = 0,
                prevY = 0,
                currY = 0;
            var strokeStyle = "black",
                lineWidth = 12,
                halfLineWidth = lineWidth / 2;
            var canvasWidth, canvasHeight;
            
                function init() {
                    canvas = document.getElementById('digit-canvas');
                    ctx = canvas.getContext("2d");
                    canvasWidth = canvas.width;
                    canvasHeight = canvas.height;
                    ctx.fillStyle = strokeStyle;
                    ctx.strokeStyle = strokeStyle;
                    ctx.lineWidth = lineWidth;
                
                    canvas.addEventListener("mousemove", function (e) {
                        onMouseEvent('move', e)
                    }, false);
                    canvas.addEventListener("mousedown", function (e) {
                        onMouseEvent('down', e)
                    }, false);
                    canvas.addEventListener("mouseup", function (e) {
                        onMouseEvent('up', e)
                    }, false);
                    canvas.addEventListener("mouseout", function (e) {
                        onMouseEvent('out', e)
                    }, false);
                }

                function onMouseEvent(res, e) {
                    switch (res) {
                        case "down":
                            drawing = true;
                            ctx.moveTo(currX, currY);

                            currX = e.clientX - canvas.offsetLeft;
                            currY = e.clientY - canvas.offsetTop;

                            fillCircle();
                            break;
                        case "up":
                            fillCircle();
                        case "out":
                            drawing = false;
                            break;
                        case "move":
                            if (drawing) {
                                prevX = currX;
                                prevY = currY;
                                currX = e.clientX - canvas.offsetLeft;
                                currY = e.clientY - canvas.offsetTop;
                                connectLine();
                            }
                            break;
                    }
                }

                function connectLine() {
                    ctx.lineTo(currX, currY);
                    ctx.stroke();
                }

                function fillCircle() {
                    ctx.beginPath();
                    ctx.arc(currX, currY, halfLineWidth, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.closePath()
                    ctx.beginPath();
                    ctx.lineTo(currX, currY);
                }

                function clearCanvas() {
                    ctx.clearRect(0, 0, canvasWidth, canvasHeight);
                }

                // AJAX stuff
                // https://stackoverflow.com/a/35203184
                $("#classify-button").click(function (e) {
                    $.ajax({
                        type: "POST",
                        url: "/classify",
                        data: { 
                            id: "Hello World"
                        },
                        success: function(result) {
                            alert('ok');
                        },
                        error: function(result) {
                            alert('error');
                        }
                    });
                });
        </script>
    </body>
</html>